name: Build Golang project
author: 'MiLaboratories'
description: |
  Build Golang project.

  Prepare agent for building a Golang project.
  Install Golang specific version, cache dependencies, re-use build results
  uploading selected build results into GitHub Actions artifacts storage.

  Requirements:
    - initialized context (actions/context/init)
  
inputs:
  golang-build target:
    description: |
      Golang project's build target
    required: true
    default: '.'

  golang-version:
    description: |
      Golang version to use.
      Examples: '1.19', '1.20'
    required: true

  cache-version:
    description: |
      Simple hack, that allows to 'reset' cache for particular job.
      
      Just change the value of this parameter and the next run will
      not find build cache and will have to start from scratch.

    required: false
    default: 'v1'

runs:
  using: "composite"

  steps:
    - id: context
      uses: milaboratory/github-ci/actions/context@v4-beta

    - name: Prepare environment for building a Golang application
      uses:  milaboratory/github-ci/actions/golang/prepare@v4-beta
      with:
        golang-version: ${{ inputs.golang-version }}
        cache-version: ${{ inputs.cache-version }}

    - name: Run golang project ci bootstrap script
      uses: milaboratory/github-ci/actions/shell@v4-beta
      with:
        run: |
           ./${{ inputs.ci-bootsrap-script }}
          
